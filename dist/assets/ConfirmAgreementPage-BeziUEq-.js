import{_ as E,s as R,v as F,r as n,c as D,B as I,o as T,x as P,e as d,g as a,t as v,f as x,j as q,z as N,A as G,C as O,D as C,l as p}from"./index-BPoUppka.js";import{saveConfirmedTask as U}from"./task-lOcNdJg6.js";const V="data:image/svg+xml,%3csvg%20width='67'%20height='67'%20viewBox='0%200%2067%2067'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_312_3734)'%3e%3crect%20width='67'%20height='67'%20rx='33.5'%20fill='%23FDC63C'%20fill-opacity='0.46'/%3e%3cg%20filter='url(%23filter0_d_312_3734)'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M6.40633%2096.713C6.90599%2096.7126%207.31524%2096.6591%207.64233%2096.5536C7.31347%2096.6597%206.90967%2096.7131%206.40633%2096.713ZM40.2992%2096.7214C40.9775%2096.7215%2041.7151%2096.5679%2042.3364%2096.3548C44.1726%2095.7251%2041.8869%2095.6599%2040.2992%2096.7214Z'%20fill='%23F4624B'/%3e%3cpath%20d='M6.40633%2096.713C6.90599%2096.7126%207.31524%2096.6591%207.64233%2096.5536C9.94425%2095.8107%208.17582%2092.4877%205.20365%2086.9027C-0.848736%2075.5297%20-16.0273%2056.6992%20-7.85679%2029.2543C4.53178%20-12.3593%2083.9701%2019.8464%2051.2975%2053.3155C49.3626%2055.2976%2046.4538%2056.1256%2043.5703%2056.046C23.8657%2055.5014%2039.2425%2065.1573%2040.2992%2096.7214L6.40633%2096.713Z'%20fill='%23F4624B'/%3e%3c/g%3e%3cline%20x1='23.5669'%20y1='26.8414'%20x2='23.5669'%20y2='30.4616'%20stroke='black'%20stroke-width='6'%20stroke-linecap='round'/%3e%3cline%20x1='37.4053'%20y1='26.8414'%20x2='37.4053'%20y2='30.4616'%20stroke='black'%20stroke-width='6'%20stroke-linecap='round'/%3e%3cline%20x1='1'%20y1='-1'%20x2='4.09181'%20y2='-1'%20transform='matrix(-0.583905%200.811822%20-0.850692%20-0.525664%2012.0408%2035.2723)'%20stroke='white'%20stroke-opacity='0.4'%20stroke-width='2'%20stroke-linecap='round'/%3e%3cpath%20d='M10.6667%2015.2538C-1.55848%2019.0686%20-2.48816%2028.7471%20-2.48816%2028.7471'%20stroke='white'%20stroke-opacity='0.4'%20stroke-width='2'%20stroke-linecap='round'/%3e%3cline%20x1='1'%20y1='-1'%20x2='4.09181'%20y2='-1'%20transform='matrix(-0.583905%200.811822%20-0.850692%20-0.525664%2015.0142%2035.2723)'%20stroke='white'%20stroke-opacity='0.4'%20stroke-width='2'%20stroke-linecap='round'/%3e%3cline%20x1='1'%20y1='-1'%20x2='4.09181'%20y2='-1'%20transform='matrix(-0.583905%200.811822%20-0.850692%20-0.525664%2017.9873%2035.2723)'%20stroke='white'%20stroke-opacity='0.4'%20stroke-width='2'%20stroke-linecap='round'/%3e%3cpath%20d='M35.0685%2056.3377C22.9489%2059.4427%2019.7238%2054.2807%2020.2495%2053.9138'%20stroke='%23BE3A3A'%20stroke-opacity='0.77'%20stroke-width='2'%20stroke-linecap='round'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='filter0_d_312_3734'%20x='-14.2178'%20y='9.55664'%20width='77.3391'%20height='95.1647'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20type='matrix'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='4'/%3e%3cfeGaussianBlur%20stdDeviation='2'/%3e%3cfeComposite%20in2='hardAlpha'%20operator='out'/%3e%3cfeColorMatrix%20type='matrix'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200.25%200'/%3e%3cfeBlend%20mode='normal'%20in2='BackgroundImageFix'%20result='effect1_dropShadow_312_3734'/%3e%3cfeBlend%20mode='normal'%20in='SourceGraphic'%20in2='effect1_dropShadow_312_3734'%20result='shape'/%3e%3c/filter%3e%3cclipPath%20id='clip0_312_3734'%3e%3crect%20width='67'%20height='67'%20rx='33.5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Z={class:"confirm-agreement-page"},z={class:"header"},K={class:"page-title"},j={class:"main-content"},J={class:"goal-title-container"},L={class:"goal-title"},H={key:0,class:"agreement-section"},Q={class:"agreement-content"},W={class:"agreement-text"},X={class:"ai-reply-bubble-container"},Y={class:"bubble-content"},$={class:"chat-input-container"},ee={class:"chat-input-wrapper"},se=["placeholder","disabled"],ae=["disabled"],te={key:0},le={key:1,class:"arrow-up"},oe={key:0,class:"error-message"},ie={class:"confirm-actions"},re=["disabled"],ne={key:0},ce={key:1},ue={__name:"ConfirmAgreementPage",setup(de){const k=P(),y=I(),A=R(),_=F(),c=n(""),l=n(""),r=n(""),f=n(!1),m=n(!1),t=n(""),o=D(()=>y.query.mode==="create"),i=n(!0),h=n(!1),u=n({visible:!1,message:""}),g=e=>{u.value.visible=!0,u.value.message=e,setTimeout(()=>{u.value.visible=!1,u.value.message=""},4e3)};T(()=>{if(o.value)c.value="新的任务",l.value="",i.value=!0,h.value=!1,setTimeout(()=>{g("你好，让我们一起来创建任务吧！")},500);else if(c.value=y.query.goal||"",l.value=y.query.agreement||"",i.value=!1,h.value=!0,!c.value||!l.value){console.warn("缺少必要参数，返回首页"),k.replace("/");return}});const B=()=>{k.back()},w=async()=>{if(!r.value.trim()){o.value&&i.value?t.value="请输入目标描述":t.value="请输入修改要求";return}t.value="",f.value=!0,u.value.visible=!1;try{let e;o.value&&i.value?e=await C(r.value.trim()):e=await C(c.value,r.value.trim(),l.value);let s;try{s=typeof e=="string"?JSON.parse(e):e}catch(b){console.error("解析AI响应失败:",b),l.value=e,g("协议已更新！"),r.value="",o.value&&i.value&&(i.value=!1,h.value=!0);return}s&&typeof s.success=="boolean"?(s.reason&&g(s.reason),s.success&&(s.title&&(c.value=s.title),s.content&&(l.value=s.content),r.value="",o.value&&i.value&&(i.value=!1,h.value=!0)),s.success||(r.value="")):(l.value=e,g("协议已更新！"),r.value="",o.value&&i.value&&(i.value=!1,h.value=!0))}catch(e){console.error("重新生成协议失败:",e),g("修改失败，请稍后重试"),e.message.includes("API密钥")?t.value="AI服务配置错误，请联系管理员":e.message.includes("timeout")||e.message.includes("超时")?t.value="请求超时，请检查网络连接后重试":e.message.includes("Network")||e.message.includes("网络")?t.value="网络连接失败，请检查网络设置":t.value=e.message||"重新生成协议失败，请稍后重试"}finally{f.value=!1}},S=()=>{t.value=""},M=async()=>{m.value=!0,t.value="";try{await U(c.value,l.value);const e=A.addTask({title:c.value,agreement:l.value});console.log("新任务已添加到状态管理:",e),_.showSuccess("目标创建成功！"),k.push("/")}catch(e){console.error("保存任务失败:",e),e.message.includes("网络")?(t.value="网络连接失败，请检查网络设置后重试",_.showError("网络连接失败，请检查网络设置后重试")):e.message.includes("timeout")||e.message.includes("超时")?(t.value="请求超时，请稍后重试",_.showError("请求超时，请稍后重试")):(t.value=e.message||"保存任务失败，请稍后重试",_.showError(t.value))}finally{m.value=!1}};return(e,s)=>(p(),d("div",Z,[a("header",z,[a("button",{class:"back-button",onClick:B},s[1]||(s[1]=[a("span",{class:"back-icon"},"<",-1)])),a("h1",K,v(o.value&&!h.value?"创建任务":"修改任务"),1),s[2]||(s[2]=a("div",{class:"header-placeholder"},null,-1))]),a("main",j,[a("div",J,[a("div",L,v(c.value),1)]),!o.value||l.value?(p(),d("section",H,[s[3]||(s[3]=a("h2",{class:"section-title"},"您的任务",-1)),a("div",Q,[a("pre",W,v(l.value),1)])])):x("",!0),a("div",X,[s[5]||(s[5]=a("div",{class:"avatar"},[a("img",{src:V,alt:"AI"})],-1)),a("div",{class:q(["ai-reply-bubble",{visible:u.value.visible}])},[s[4]||(s[4]=a("div",{class:"bubble-arrow"},null,-1)),a("div",Y,v(u.value.message),1)],2)]),a("div",$,[a("div",ee,[N(a("input",{"onUpdate:modelValue":s[0]||(s[0]=b=>r.value=b),class:"chat-input",placeholder:o.value&&i.value?"描述您希望如何生成任务...":"描述您希望如何修改任务...",onKeyup:O(w,["enter"]),onFocus:S,disabled:f.value||m.value},null,40,se),[[G,r.value]]),a("button",{class:"send-button",disabled:!r.value.trim()||f.value||m.value,onClick:w},[f.value?(p(),d("span",te,"⏳")):(p(),d("span",le))],8,ae)]),t.value?(p(),d("div",oe,v(t.value),1)):x("",!0)]),a("div",ie,[a("button",{class:"action-button primary",disabled:f.value||m.value||o.value&&!l.value.trim(),onClick:M},[m.value?(p(),d("span",ne,v(o.value?"创建中...":"保存中..."),1)):(p(),d("span",ce,v(o.value?"创建任务":"保存修改"),1))],8,re)])])]))}},fe=E(ue,[["__scopeId","data-v-bcbb4551"]]);export{fe as default};
